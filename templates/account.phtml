<div class="account-page">
    <h2>Account</h2>

    <div class="account-grid">
        <aside class="sidebar">
            <div class="user-info">
                <h3><?= htmlspecialchars($_SESSION['user']['username']) ?></h3>
                <div class="user-badge">
                    <div class="badge-wrapper">
                        <?= $badgeContent ?>
                        <p>
                            <strong><?= $doneCount ?></strong> task<?= $doneCount > 1 ? 's' : '' ?> done ! 
                            <a href="rank.php" class="btn-rank">Show rank page</a>
                        </p>
                    </div>
                </div>
                <p class="email"><?= htmlspecialchars($userInfo['email']) ?></p>
                <p class="date">Registration: <?= date('d/m/Y', strtotime($userInfo['created_at'])) ?></p>
                <a href="delete_account.php" class="delete-link" onclick="return confirm('√ätes-vous s√ªr ?')">Delete my account</a>
            </div>

            <div class="new-task-form">
                <h3>New Task</h3>
                <form action="addtask.php" method="POST">
                    <label for="title">Title</label>
                    <input type="text" id="title" name="title" required>
                    <label for="content">Content</label>
                    <textarea id="content" name="content" rows="5"></textarea>
                    <div class="switches">
                        <label>Urgent <input type="checkbox" name="urgent"></label>
                        <label>Important <input type="checkbox" name="important"></label>
                    </div>
                    <button type="submit" class="btn-add">Add</button>
                </form>
            </div>
        </aside>

        <div class="main-content">
            <section class="tasks-list">
                <h3>Your tasks</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Content</th>
                            <th>Urgent</th>
                            <th>Important</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <?php if (empty($tasks)): ?>
                            <tr><td colspan="5" style="text-align:center;">No active tasks.</td></tr>
                        <?php else: ?>
                            <?php foreach ($tasks as $task): ?>
                                <tr>
                                    <td><strong><?= htmlspecialchars($task['title']) ?></strong></td>
                                    <td><?= htmlspecialchars($task['content']) ?></td>
                                    <td><span class="dot <?= $task['is_urgent'] ? 'blue' : 'gray' ?>"></span></td>
                                    <td><span class="dot <?= $task['is_important'] ? 'blue' : 'gray' ?>"></span></td>
                                    <td class="actions-cell">
                                        <div class="actions-wrapper">
                                            <a href="completetask.php?id=<?= $task['id'] ?>" class="btn-check" title="Complete">‚úî</a>
                                            <a href="edittask.php?id=<?= $task['id'] ?>" class="btn-edit" title="Edit">‚úè</a>
                                            <a href="deletetask.php?id=<?= $task['id'] ?>" class="btn-delete" title="Delete">üóë</a>
                                        </div>    
                                    </td>
                                </tr>
                            <?php endforeach; ?>
                        <?php endif; ?>
                    </tbody>
                </table>
            </section>

            <section class="history-section">
                <h3><i class="fa-solid fa-clock-rotate-left"></i> History of Completed Tasks</h3>
                <?php if (empty($completedTasks)): ?>
                    <p class="empty-msg">No completed tasks yet. Time to be productive!</p>
                <?php else: ?>
                    <div class="history-grid">
                        <?php foreach ($completedTasks as $task): ?>
                            <div class="history-item">
                                <i class="fa-solid fa-circle-check"></i>
                                <div class="history-text">
                                    <span class="history-title"><?= htmlspecialchars($task['title']) ?></span>
                                    <small>Finished on <?= date('d/m/Y', strtotime($task['created_at'])) ?></small>
                                </div>
                            </div>
                        <?php endforeach; ?>
                    </div>
                <?php endif; ?>
            </section>
        </div>
    </div>
</div>